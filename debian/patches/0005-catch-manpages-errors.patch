From dddbb8a760567e71d850bf1caf03f458790df72c Mon Sep 17 00:00:00 2001
From: Stefano Rivera <stefano@rivera.za.net>
Date: Tue, 10 May 2011 20:24:46 +0200
Subject: [PATCH] catch manpages errors.

---
 docs/Makefile.am |    4 ++++
 docs/Makefile.in |    5 +++++
 2 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/docs/Makefile.am b/docs/Makefile.am
index 62dd479..d0b2b49 100644
--- a/docs/Makefile.am
+++ b/docs/Makefile.am
@@ -125,6 +125,7 @@ FAQ.txt:
 
 # the valgrind manpages
 man-pages:
+	set -e; \
 	for x in $(XSL_MAN_STYLES) ; do \
 	    if test -f $$x; then \
 		echo "Using manpage stylesheet: $$x"; \
@@ -176,6 +177,7 @@ print-docs:
 # be the one to handle the else/endif parts, not GNU make
 # as we intend.
 install-data-hook:
+	set -e; \
 	if test -r html ; then \
 		mkdir -p $(DESTDIR)$(datadir)/doc/valgrind; \
 		cp -r html $(DESTDIR)$(datadir)/doc/valgrind; \
@@ -187,10 +189,12 @@ install-data-hook:
 		fi \
 	done
  ifeq ($(BUILD_ALL_DOCS),yes)
+	set -e; \
 	if test -r index.pdf ; then \
 		mkdir -p $(DESTDIR)$(datadir)/doc/valgrind; \
 		cp index.pdf $(DESTDIR)$(datadir)/doc/valgrind/valgrind_manual.pdf; \
 	fi
+	set -e; \
 	if test -r index.ps ; then \
 		mkdir -p $(DESTDIR)$(datadir)/doc/valgrind; \
 		cp index.ps $(DESTDIR)$(datadir)/doc/valgrind/valgrind_manual.ps; \
diff --git a/docs/Makefile.in b/docs/Makefile.in
index 72ad016..28a513a 100644
--- a/docs/Makefile.in
+++ b/docs/Makefile.in
@@ -477,6 +477,7 @@ FAQ.txt:
 
 # the valgrind manpages
 man-pages:
+	set -e; \
 	for x in $(XSL_MAN_STYLES) ; do \
 	    if test -f $$x; then \
 		echo "Using manpage stylesheet: $$x"; \
@@ -528,10 +529,12 @@ print-docs:
 # be the one to handle the else/endif parts, not GNU make
 # as we intend.
 install-data-hook:
+	set -e; \
 	if test -r html ; then \
 		mkdir -p $(DESTDIR)$(datadir)/doc/valgrind; \
 		cp -r html $(DESTDIR)$(datadir)/doc/valgrind; \
 	fi
+	set -e; \
 	for f in *.1 ; do \
 		if test -r $$f ; then \
 			mkdir -p $(DESTDIR)$(mandir)/man1; \
@@ -539,10 +542,12 @@ install-data-hook:
 		fi \
 	done
  ifeq ($(BUILD_ALL_DOCS),yes)
+	set -e; \
 	if test -r index.pdf ; then \
 		mkdir -p $(DESTDIR)$(datadir)/doc/valgrind; \
 		cp index.pdf $(DESTDIR)$(datadir)/doc/valgrind/valgrind_manual.pdf; \
 	fi
+	set -e; \
 	if test -r index.ps ; then \
 		mkdir -p $(DESTDIR)$(datadir)/doc/valgrind; \
 		cp index.ps $(DESTDIR)$(datadir)/doc/valgrind/valgrind_manual.ps; \
-- 
1.7.5.1.290.g2095dc

